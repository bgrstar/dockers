FROM php:5.6-apache

MAINTAINER nobgr nobgr@foxmail.com

ARG DOWNLOAD_PATH=/usr/local/src

WORKDIR /var/www/html/

RUN cp /etc/apt/sources.list /etc/apt/sources.listbak \
    &&echo "deb http://ftp.cn.debian.org/debian/ stretch main" > /etc/apt/sources.list\
    &&echo "deb http://ftp.cn.debian.org/debian/ stretch-updates main" >> /etc/apt/sources.list \
    &&echo "deb http://ftp.cn.debian.org/debian-security stretch/updates main" >> /etc/apt/sources.list\
    &&apt-get update\
    &&apt-get install unzip vim -y

RUN apt-get update && apt-get install -y \
        libfreetype6-dev \
        libjpeg62-turbo-dev \
        libpng-dev \
    && docker-php-ext-configure gd --with-freetype --with-jpeg \
    && docker-php-ext-install -j$(nproc) gd


RUN set -ex \
    &&docker-php-ext-install mysql mysqli \
    &&curl -o ${DOWNLOAD_PATH}/imcat.zip https://codeload.github.com/peacexie/imcat/zip/ccff706ca5bf1f9a09f15efa305874db84b33cd8\
    &&cp ${DOWNLOAD_PATH}/imcat.zip imcat.zip\
    &&unzip imcat.zip\
    &&rm imcat.zip;mv imcat-ccff706ca5bf1f9a09f15efa305874db84b33cd8/* ./;rm -rf imcat-ccff706ca5bf1f9a09f15efa305874db84b33cd8a\
    &&sed -i "s/localhost/mysql/g" root/cfgs/boot/cfg_db.php\
    &&chown -R www-data ./
